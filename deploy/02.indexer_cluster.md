# 1. indexer 포트 정보

스플렁크 인스턴스 별 사용하는 기본 port는 아래와 같다.

![splunk_default_port](https://user-images.githubusercontent.com/6319057/47469200-9a1b8e00-d83a-11e8-85c0-0dd1a67c81e0.PNG)

테스트 용도의 포트 정보는 아래와 같다.

인스턴스|용도|포트|비고
---- | ---- | ---- | ----
idx_1|web port|8000|
----|mgmt port|8089|
----|appserver port|8065|
----|kvstore port|8191|
idx_2|web port|8000|
----|mgmt port|8089|
----|appserver port|8065|
----|kvstore port|8191|
idx_3|web port|8000|
----|mgmt port|8089|
----|appserver port|8065|
----|kvstore port|8191|

# 2. indexer cluster 설정
## 2.1. 기본 개념

![splunk_indexer_cluster_base](https://user-images.githubusercontent.com/6319057/47469858-119eec80-d83e-11e8-96a1-96ab16bc5604.PNG)

인덱서 클러스터는 서로의 데이터를 복제하도록 구성된 인덱서 그룹이다. 클러스터에 포함된 인스턴스간에 데이터의 복사본을 서로 유지하며, 이를 인덱스 복제라고 한다. 데이터를 복제하여 데이터 손실을 방지하고 검색을 위한 데이터 가용성을 향상시킨다.

- 마스터 노드  
클러스터를 관리하는 역할을 함. 피어 노드 간에 복제를 조정하고 검색헤드에 데이터를 찾을 위치를 알려준다. 또한 피어 노드의 구성을 관리하며 피어가 중단된 경우의 작업을 관리한다.  
마스터 노드는 피어 노드 또는 검색 헤드와 동일한 인스턴스 또는 머신에 있을 수 없다.
- 피어 노드  
클러스터를 구성하는 인스턴스임. 피어 노드는 다른 노드의 데이터 사본을 동시에 저장하면서 자신의 수신 데이터를 인덱싱할 수 있다. 최소한 복제 팩터(replication factor)만큼의 피어 노드가 있어야 함. 즉, 복제 팩터가 3을 지원하려면 최소한 3개의 피어 노드가 있어야 한다.

- replication factor(복제 팩터)  
클러스터가 유지하는 데이터의 사본 수를 결정함.  

![splunk_rf_base](https://user-images.githubusercontent.com/6319057/47470230-d1d90480-d83f-11e8-8c6f-a37fcc98de6b.PNG)

클러스터는 (복제 팩터 - 1) 수의 피어 노드 다운에 대해서 가용성을 보장한다. 예를 들어 어느 시스템에서 2개의 피어 노드의 다운에 대비하려면 복제 팩터를 3으로 구성해야 한다. 복제 팩터 기본 값은 3임.

- search factor(검색 팩터)  
클러스터가 유지하는 데이터에 대해서 검색 가능한 사본 수를 결정함. 피어 노드가 작동이 중지된 후 클러스터의 검색의 가용성에 초점이 있다. 
검색 가능한 데이터 복사본은 검색할 수 없는 복사본보다 많은 저장 공간이 필요하므로 요구사항에 맞게 정확하게 산정되어야 한다. 대부분의 경우에 검색 팩터는 2를 사용함. 검색 가능한 데이터와 검색할 수 없는 데이터의 차이점은 다음과 같다. 검색 가능한 데이터는 데이터 자체와 클러스터가 데이터 검색에 사용하는 확장된 인덱스 파일이 모두 포함되어 있다. 검색할 수 없는 데이터에는 데이터만 포함된다.

- bucket  
버킷은 인덱스가 저장되는 기본 단위이다. 클러스터는 각 버킷의 복제 팩터 수를 유지한다. 즉, 복제 팩터만큼 버킷을 복제한다. 스플렁크는 인덱싱된 데이터를 데이터 파일을 포함하는 디렉터리인 버킷에 저장한다. 일반적으로 인덱스는 여러 버킷으로 구성된다. 버킷은 검색 가능하거나 검색 불가능하다.  
버킷은 두가지 유형의 파일을 포함한다.  
(주의 : 복제된 버킷은 오직 rawdata만 가짐)  
1) rawdata  
압축된 원시 데이터(raw text, timestamp, source, sourcetype, host 정보)  
압축된 사이즈는 데이터 성격에 따라 다름(syslog format 데이터는 10~15% 정도 압축됨)
2) index files(.tsidx)  
인덱스 시간 관련 설정 정보
원시 데이터 기준으로 10~110% 정도 압축됨  
압축된 사이즈는 인덱스 시간의 필드 추출 등의 설정량에 따라 달라짐.(설정 수 가 많으면 압축율 떨어짐)

## 2.2. 클러스터 이점
- Data availability(데이터 가용성)  
인덱서는 들어오는 데이터를 처리할 수 있으며 인덱싱된 데이터는 검색할 수 있다.
- Data fidelity(데이터 충실도)  
클러스터에 전송된 데이터와 이 데이터가 인덱싱된 이후와 정확히 일치한다.
- Data recovery(데이터 복구)  
인덱서가 다운되더라도 다른 인덱서에서 데이터 손실 없이 액세스 가능하다.
- Disaster recovery(재해 복구)  
멀티사이트 클러스터링을 사용하면 시스템이 전체 데이터 센터의 장애를 견딜 수 있다.

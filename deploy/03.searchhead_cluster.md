# 1. 서치헤더 클러스터 설정
## 1.1. 기본 개념

![splunk_searchhead_cluster](https://user-images.githubusercontent.com/6319057/47482239-f4cfdc80-d870-11e8-93c5-c8ecd63dbedc.PNG)

서치헤더 클러스터의 모든 노드는 동일한 검색 결과, 대시보드, 검색 아티팩트를 공유한다.  
서치헤더 클러스터는 서치헤더의 그룹으로 이루어진다. 각 서치헤더는 클러스터 멤버로 불린다.  

- captain  
클러스터 내 하나의 서치헤더는 captain으로 선정된다. captain은 동일하게 다른 서치헤더처럼 동작하며 추가적으로 job scheduling과 멤버간 복제에 대해서도 관장한다. captain의 종류는 2가지가 있다.  
  - dynamic captain  
  일반적인 방법으로 선거에 의해 선출된 captain을 말함.  
  - static captain  
  재해 복구시 임의로 설정한 captain을 말함  
  
- captain의 역할  
  - job 스케쥴링  
  검색 job을 현재 멤버의 부하를 고려하여 각 멤버에 할당함  
  - knowledge bundle 배포  
  각 검색 peer에 knowledge bundle(knowledge object의 번들) 배포함  
  - artifact 복제 조정  
  replication factor를 고려하여 search artifact를 복제함  
  서치헤더 클러스터의 replication factor는 클러스터 내 search artifact, search 결과의 복제본 수를 의미한다. 오직 스케쥴링된 saved search에 대해서만 복제가 이루어진다. ad-hoc 검색이나 realtime 검색은 복제 대상이 아니다.  
  
- 서치헤더 클러스터의 replication factor  
(replication factor - 1) 수 만큼의 멤버 다운에 대해서 search artifact에 대한 가용성을 가진다. 기본 replication factor는 3이다. 대부분의 환경에서 3이 만족을 한다. 


## 1.2. 서치헤더 클러스터 이점

- Horizontal scaling(수평 확장)  
사용자 수와 검색 로드가 증가함에 따라 새로운 서치헤더를 클러스터에 추가할 수 있다.
- High availability(높은 가용성)  
서치헤더가 다운되면 다른 클러스터 내 서치헤더가 동일한 검색에 대한 결과를 가진다.
- No single point of failure(단일 실패 지점이 없음)  
서치헤더 클러스터는 동적 캡틴을 사용하여 클러스터를 관리한다. 캡틴이 다운되면 다른 멤버가 자동으로 클러스터 관리를 대신한다.

## 1.3. 서치헤더 클러스터 멤버간 공유 내용

서치헤더 클러스터는 클러스터 멤버라고 불리는 서치헤더로 구성된다. 클러스터 내 캡틴은 클러스터 내 모든 작업을 관장한다.  

- Job scheduling(작업 스케쥴링)  
클러스터는 작업에 대해서 중앙 집중식으로 관리하며, 예약된 검색에 대해서 일반적으로 로드가 가장 적은 멤버에게 작업을 할당한다.
- Search artifacts(검색 아티팩트)  
클러스터는 검색 아티팩트를 복제하여 모든 멤버가 사용할 수 있도록 한다.  
- Configurations(설정)  
클러스터는 모든 멤버가 동일한 설정을 공유한다.

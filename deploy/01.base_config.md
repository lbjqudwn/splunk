# 1. 기본 설정

스플렁크 분산환경 구성 이전에 OS 및 기본 스플렁크 설정

- OS : CentOS 7
- Splunk Enterprise : 7.2.0
- Splunk Universal Forwarder : 7.2.0

## 1.1 OS 설정

- 방화벽 down
```
systemctl stop firewalld
# 리부팅시에도 실행 안되게끔 
systemctl disable firewalld
```
- hostname 변경
```
# hostname 확인
hostname
# hostname 변경
hostnamectl set-hostname <hostname>
reboot
```
- wget 설치
```
yum -y install wget
```

## 1.2 스플렁크 관련 OS 파라미터 설정

- splunk 사용자 bash_profile 샘플  
```
export PS1='[\u@$PWD ]'

SPLUNK_HOME=/home/splunk/work/splunk

alias sphome='cd $SPLUNK_HOME'
alias splocal='cd $SPLUNK_HOME/etc/system/local'
alias spapps='cd $SPLUNK_HOME/etc/apps'
alias spetc='cd $SPLUNK_HOME/etc'
alias spstart='$SPLUNK_HOME/bin/splunk start'
alias spstop='$SPLUNK_HOME/bin/splunk stop'
alias sprestart='$SPLUNK_HOME/bin/splunk restart'

set -o vi
```

- selinux disable  
  - 확인  
  ```
  #getenforce
  Enfrocing

  #sestatus
  SELinux status:                 enabled
  SELinuxfs mount:                /sys/fs/selinux
  SELinux root directory:         /etc/selinux
  Loaded policy name:             targeted
  Current mode:                   enforcing
  Mode from config file:          enforcing
  Policy MLS status:              enabled
  Policy deny_unknown status:     allowed
  Max kernel policy version:      28
  ```
  
  - 영구적 구성  
    - 대상파일  
    ```
    /etc/selinux/config
    ```
    - 대상 파일의 내용 중 아래를 바꾸고 저장, OS 리부팅 필요  
    ```
    #SELINUX=enforcing => disabled
    SELINUX=disabled
    ```
  - 확인  
  ```
  # getenforce
  Disabled
  # 또는
  #sestatus
  SELinux status:   disabled

  ```

# 2. 스플렁크 아키텍처

분산배포 환경으로 서치헤더 클러스터, 인덱서 클러스터를 구성한다. 관리서버는 스플렁크 아키텍처의 전반적인 관리를 담당하며, Cluster Master, Deployer, Deployment Server, License Master, Monitoring Console로 구성된다.

![splunk_architecture](https://user-images.githubusercontent.com/6319057/47417248-8af0fd80-d7b2-11e8-942a-9ec1c7252d07.png)

스플렁크 인스턴스 대수 정보는 아래와 같다.

- Search Head : 3대
- Indexer : 3대
- Universal Forwarder : 2대
- CM, DP, DS, LM, MC : 각 1대

가상머신 환경에서 테스트를 진행했으며, 각 인스턴스 별 IP, 포트 정보는 아래와 같다.

hostname | ip | 비고
---- | ---- | ----
uf_1 |192.168.163.151|
uf_2 |192.168.163.152|
idx_1 |192.168.163.153|
idx_2 |192.168.163.154|
idx_3 |192.168.163.155|
sh_1 |192.168.163.156|
sh_2 |192.168.163.157|
sh_3 |192.168.163.158|
CM, DP, DS, LM, MC |192.168.163.159| 동일 가상머신에 설치함
